
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html"; charset="utf-8" />
    <title></title>
    <link href="/static/work/js/bstable/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/static/work/js/bstable/css/bootstrap-table.css" rel="stylesheet" type="text/css">
    
    <link href="/static/work/css/table.css" rel="stylesheet" type="text/css">
</head>
<body style="background-color: #ecf0f5;font-family: 微软雅黑;color: #475059;min-width: 1000px;overflow: auto">
<div class="notice_main">
    <!--
    <h6>表格一</h6>
    <div style="border-bottom: 1px #ccc solid;padding-bottom: 8px">
        <p style="line-height: 24px;font-size: 14px;padding: 4px 0 0 36px ;color:#bb8940;background-image: url(img/ts_03.png);background-repeat: no-repeat;background-position: 10px 8px;font-weight: bold">温馨提示</p>
        <ul class="ts">
            <li><span>*</span>该页面主要显示的是表格一的类容。</li>
            <li><span>*</span>该页面主要显示的是表格一的类容。</li>
        </ul>
    </div>
    -->
    <div class="notice_check">
        <!-- 选择楼栋  -->
        <div class="btn-group l_left" style="margin-right: 4px">
            <button type="button" class="btn btn-default change build" style="height: 30px;line-height: 30px;padding: 0 12px !important;font-size: 12px">选择楼栋</button>
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height: 30px;line-height: 30px">
                <span class="caret"></span>
                <span class="sr-only"></span>
            </button>
            <ul class="dropdown-menu one">
                <li value='A'>A栋</li>
                <li value='B'>B栋</li>
                <li value='C'>C栋</li>
                <li value='D'>D栋</li>
                <li value='E'>E栋</li>
            </ul>
        </div>
        <!-- 选择楼层  -->
        <div class="btn-group l_left" style="margin-right: 4px">
            <button type="button" class="btn btn-default change floor" style="height: 30px;line-height: 30px;padding: 0 12px !important;font-size: 12px">选择楼层</button>
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height: 30px;line-height: 30px">
                <span class="caret"></span>
                <span class="sr-only"></span>
            </button>
            <ul class="dropdown-menu two">
                <li value='1'>1楼</li>
                <li value='2'>2楼</li>
                <li value='3'>3楼</li>
                <li value='4'>4楼</li>
                <li value='5'>5楼</li>
            </ul>
        </div>
        <!-- 选择规模  -->
        <div class="btn-group l_left" style="margin-right: 4px">
            <button type="button" class="btn btn-default change size" style="height: 30px;line-height: 30px;padding: 0 12px !important;font-size: 12px">选择规模</button>
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height: 30px;line-height: 30px">
                <span class="caret"></span>
                <span class="sr-only"></span>
            </button>
            <ul class="dropdown-menu four">
                <li>无要求</li>
                <li value='20'>20人</li>
                <li value='50'>50人</li>
                <li value='80'>80人</li>
                <li value='120'>120人</li>
                <li value='200'>200人</li>               
            </ul>
        </div>
        <!-- 选择类别  -->
        <div class="btn-group l_left" style="margin-right: 4px">
            <button type="button" class="btn btn-default change type" style="height: 30px;line-height: 30px;padding: 0 12px !important;font-size: 12px">选择类别</button>
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height: 30px;line-height: 30px">
                <span class="caret"></span>
                <span class="sr-only"></span>
            </button>
            <ul class="dropdown-menu five">
                <li value='0'>普通课室</li>
                <li value='1'>多媒体课室</li>
                <li value='2'>多媒体录播课室</li>           
            </ul>
        </div>
        <button class="check_btn" id = "check">查询</button>
        <button class="check_btn" style = "" id ="add">新增</button>
    </div>
    <div>
        <table id="table" class = "table_style" style="margin: 0 auto" >
        </table>
    </div>
</div>
{% comment %} 展示设备详情 {% endcomment %}
    <div class="modal fade" id="device_detail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content" >
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">课室设备详情</h4>
                </div>
                <div class="modal-body" style = "padding-bottom : 65px;">
                    <table id="device_table" class = "table_style">
                    </table>
                    
                </div>
                
                
            </div>
        </div>
    </div>
{% comment %} 修改课室信息 {% endcomment %}
    <div class="modal fade" id="modify" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">修改信息</h4>
                </div>
                <div class="modal-body">
                    <label for="classroom_id">课室编号</label>
                    <input type="text" class="form-control" id="classroom_id">
                    <p></p>
                    <label for="classroom_size">课室规模</label>
                    <input type="text" class="form-control" id="classroom_size">
                    <p></p>
                    <label for="classroom_category">课室规模</label>
                    <p></p>
                    <div class="btn-group l_left" style="margin-right: 4px">
                        <button type="button" class="btn btn-default change" id = "classroom_category" style="height: 30px;line-height: 30px;padding: 0 12px !important;font-size: 12px">选择课室类型</button>
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height: 30px;line-height: 30px">
                            <span class="caret"></span>
                            <span class="sr-only"></span>
                        </button>
                        <ul class="dropdown-menu six">
                            <li value='0'>普通课室</li>
                            <li value='1'>多媒体课室</li>
                            <li value='2'>多媒体录播课室</li>           
                        </ul>
                    </div>
                    <p><span class="pull-left text-danger"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="comfirm">确认修改</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>

{% comment %} 新增课室 {% endcomment %}
    <div class="modal fade" id="add_classroom" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">新增课室</h4>
                </div>
                <div class="modal-body">
                    <label for="classroom_id">课室编号</label>
                    <input type="text" class="form-control" id="add_classroom_id">
                    <p></p>
                    <label for="classroom_size">课室规模</label>
                    <input type="text" class="form-control" id="add_classroom_size">
                    <p></p>
                    <label for="classroom_size">课室类型</label>
                    <div class="btn-group l_left" style="margin-right: 4px">
                        <button type="button" class="btn btn-default change" id = "add_classroom_category" style="height: 30px;line-height: 30px;padding: 0 12px !important;font-size: 12px">选择课室类型</button>
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height: 30px;line-height: 30px">
                            <span class="caret"></span>
                            <span class="sr-only"></span>
                        </button>
                        <ul class="dropdown-menu seven">
                            <li value='0'>普通课室</li>
                            <li value='1'>多媒体课室</li>
                            <li value='2'>多媒体录播课室</li>           
                        </ul>
                    </div>
                    <p><span class="pull-left text-danger"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="confirm_add">确认增加</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>
{% comment %} 提示框 {% endcomment %}
    <div class="modal fade" id="warnform" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">提醒框</h4>
                </div>
                <div class="modal-body" id="warn"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

<script src="/static/work/js/jquery/jQuery-2.2.0.min.js"></script>
<script src="/static/work/js/bstable/js/bootstrap.min.js"></script>
<script src="/static/work/js/bstable/js/bootstrap-table.js"></script>
<script src="/static/work/js/bstable/js/bootstrap-table-zh-CN.min.js"></script>
<script src="/static/work/js/layer_v2.1/layer/layer.js"></script>
<script type="text/javascript">
    var _table, device_table;
    var classroom_size, classroom_category, classroom_build, classroom_floor;
    var add_category_value, modify_category_value;
    $(function () {
        changeOneFour();
        _table = $("#table").bootstrapTable({
            columns: [
                { checkbox: true },
                { title: '课室', field : 'classroom_id'},
                { title: '规模', field: 'size' },
                { title: '状态', field: 'status' },
                { title: '类型', field: 'category' },
                {
                    title: '占用情况', 
                    field: 'occupation', 
                    formatter: function (value, row, index) {
                        var html = '<a href="#" onclick="detail(this)">查看详情</a>';
                        return html;
                    }
                },
                {
                    title: '内部设备', 
                    field: 'devices', 
                    formatter: function (value, row, index) {
                        var html = '<a href="#" onclick="device(this)">查看详情</a>';
                        return html;
                    }
                },
                {
                    title: '操作', 
                    field: 'operate', 
                    formatter: function (value, row, index) {
                        var _html = '<a href="#" onclick="modify(this)">编辑</a>';
                        _html += '<a href="#" onclick="suspend(this)">停用</a>';
                        _html += '<a href="#" onclick="active(this)">恢复</a>';
                        _html += '<a href="#" onclick="_delete(this)">删除</a>';
                        return _html;
                    }
                }
            ],
            url : '/classroom_info/',
            cache : false,
            method : 'get',
            queryParamsType: '',
            queryParams: queryParams,
            pagination: true,
            pageNumber: 1,
            pageSize: 10,
            pageList: [10, 20, 50],
            sidePagination: "server",
            pageNumber: 1,
            search: false, //显示搜索框
            uniqueId: "classroom_id",
            paginationPreText: "上一页",
            paginationNextText: "下一页",  
        });
    });
    function changeOneFour(){
        $(".dropdown-menu.one>li").click(function(){
            $(this).parent().siblings(".change").html($(this).html());
            classroom_build = $(this).attr("value");
        })
        
        $(".dropdown-menu.two>li").click(function(){
            $(this).parent().siblings(".change").html($(this).html());
            classroom_floor = $(this).attr("value");
        })   
    
        $(".dropdown-menu.four>li").click(function(){
            $(this).parent().siblings(".change").html($(this).html());
            classroom_size = $(this).attr("value");
                
        })

        $(".dropdown-menu.five>li").click(function(){
            $(this).parent().siblings(".change").html($(this).html());
            classroom_category = $(this).attr("value");
                
        })
        
        $(".dropdown-menu.six>li").click(function(){
            $(this).parent().siblings(".change").html($(this).html());
            if($(this).attr("value")){
                modify_category_value = $(this).attr("value");
            }
                
        })

        $(".dropdown-menu.seven>li").click(function(){
            $(this).parent().siblings(".change").html($(this).html());
            if($(this).attr("value")){
                add_category_value = $(this).attr("value");
            }
                
        })

        $(".change.build").click(function(){
            $(this).text("选择楼栋");
            classroom_build = null;
        })

        $(".change.floor").click(function(){
            $(this).text("选择楼层");
            classroom_floor = null;
        })

        $(".change.size").click(function(){
            $(this).text("选择规模");
            classroom_size = null;
        })

        $(".change.type").click(function(){
            $(this).text("选择类别");
            classroom_category = null;
        })

    }

    


    function queryParams(params) {

        return {
            pageSize: params.pageSize,
            pageIndex: params.pageNumber,
            size : classroom_size,
            build : classroom_build,
            floor : classroom_floor,
            category : classroom_category,
        };
    }

    $("#check").bind('click',function(){
        _table.bootstrapTable('refresh',{'pageNumber' : 1});
        return false;
    });

    $("#add").bind('click', function(){
        $("#add_classroom_id").val("");
        $("#add_classroom_size").val("");
        $("#add_classroom_category").text("");
        $("#add_classroom").modal('show');

    });

    function suspend(e){
        var classroom_id = $(e).parent().siblings(":eq(1)").text();
        var status = $(e).parent().siblings(":eq(3)");
        $.ajax({
            url : '/suspend_classroom/' + classroom_id + '/',
            cache : false,
            type : 'get',
            success : function(data){
                status.text('已停用');
                $("#warn").text(data['message']);
                $("#warnform").modal('show');
            }
        });
    }

    
    function _delete(e){
        var classroom_id = $(e).parent().siblings(":eq(1)").text();
        alert("确认删除课室：" + classroom_id + " ?");
        $.ajax({
            url : '/delete_classroom/' + classroom_id + '/',
            cache : false,
            async : false,
            type : 'get',
            success : function(data){
                _table.bootstrapTable('refresh',{'pageNumber' : 1});
                $("#warn").text(data['message']);
                $("#warnform").modal('show');   
            }
        });
    }

    function active(e){
        var classroom_id = $(e).parent().siblings(":eq(1)").text();
        var status = $(e).parent().siblings(":eq(3)");
        $.ajax({
            url : '/active_classroom/' + classroom_id + '/',
            cache : false,
            async : false,
            type : 'get',
            success : function(data){
                status.text('已启用');
                $("#warn").text(data['message']);
                $("#warnform").modal('show');
            }
        });
    }

    var modify_classroom_id, modify_size, modify_category;
    function modify(e){
        modify_category_value = null;//初始化提交到后台更改的课室类别的值
        modify_classroom_id = $(e).parent().siblings(":eq(1)");
        modify_size = $(e).parent().siblings(":eq(2)");
        modify_category = $(e).parent().siblings(":eq(4)");
        $("#classroom_id").val(modify_classroom_id.text());
        $("#classroom_size").val(modify_size.text());
        $("#classroom_category").text(modify_category.text());
        $("#modify").modal('show'); 
    }

    function queryParamsForDevice(params) {
        return {
            pageSize: params.pageSize,
            pageIndex: params.pageNumber,
        };
    }
    function device(e){
        var classroom_id = $(e).parent().siblings(":eq(1)").text();
        
        device_table = $("#device_table").bootstrapTable({
            columns:[
                {checkbox:true},
                {title : '设备类别', field : 'device_type'},
                {title : '设备名称', field : 'device_name'},
                {title : '设备数目', field : 'device_quatity'},
            ],
            url : '/classroom_device/' + classroom_id + '/',
            cache : false,
            method : 'get',
            queryParamsType: '',
            queryParams: queryParamsForDevice,
            pagination: true,
            pageNumber: 1,
            pageSize: 5,
            pageList: [10, 20, 50],
            sidePagination: "server",
            pageNumber: 1,
            search: false, //显示搜索框
            uniqueId: "netid",
            paginationPreText: "上一页",
            paginationNextText: "下一页", 
            width : 600,

        });
        $("#device_detail").modal('show');
    }

    function detail(e){
        var classroom_id = $(e).parent().siblings(":eq(1)").text();
        window.location.href = '/classroom_detail/' + classroom_id + '/';
    }

    $("#comfirm").bind('click',function(){
        $.ajax({
            url : '/modify_classroom/' + modify_classroom_id.text() + '/',
            cache : false,
            type : 'get',
            data : {
                'new_id' : $("#classroom_id").val(),
                'size' : $("#classroom_size").val(),
                'category' : modify_category_value,
            },
            success : function(data) {
                modify_classroom_id.text(data['new_id']);
                modify_size.text(data['new_size']);
                modify_category.text(data['new_category'])
                $("#modify").modal('hide');
                $("#warn").text(data['message']);
                $("#warnform").modal("show"); 
            }
        });
        return false;
    });

    $("#confirm_add").bind('click', function(){
        var add_id = $("#add_classroom_id").val();
        var add_size = $("#add_classroom_size").val();
        $.ajax({
            url : '/add_classroom/' + add_id +'/',
            cache : false,
            type : 'get',
            data:{
                'classroom_id' : add_id,
                'classroom_size' : add_size,
                'classroom_category' : add_category_value,
            },
            success : function(data){
                _table.bootstrapTable('refresh',{'pageNumber' : 1});
                $("#add_classroom").modal('hide');
                $("#warn").text(data['message']);
                $("#warnform").modal('show');
            }
        });
        return false;
    });

</script>

</body>
</html>
